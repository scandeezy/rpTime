<!-- $scope is on TimeSheetPageCtrl -->
<div id="timesheets" class="container">
	<div class="panel panel-default" ng-hide="edit">
		<div class="panel-heading">
			<h4>
				Time Sheets
				<div class="pull-right">
					<div class="btn-group">
						<button type="button" id="new" class="btn btn-primary btn-sm" ng-click="set();">Create</button>
						<button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
							<span class="caret"></span> <span class="sr-only">Toggle Create Dropdown</span> &nbsp;
						</button>
						<ul class="dropdown-menu" role="menu">
							<li><a ng-click="setWeekLast();">Last Week</a></li>
							<li><a ng-click="set();">This Week <i>(default)</i></a></li>
							<li><a ng-click="setWeekNext();">Next Week</a></li>
							<li class="divider"></li>
							<li><a ng-click="setWeekOther();">Other...</a></li>
						</ul>
					</div>
					<div class="col-sm-2">
					</div>
				</div>
			</h4>
		</div>
		<div class="panel-body" ng-hide="isAdmin">
			<ul>
				<li ng-repeat="timeSheet in timeSheetsList" ng-init="worker=workersMap[timeSheet.workerId]">
					<a ng-click="set(timeSheet)">{{timeSheet.year}},
						week {{timeSheet.week}} - {{timeSheet.startDate}}</a>
					<span ng-show="timeSheet.status=='UNSUBMITTED'" class="label label-warning">Not Submitted</span>
					<span ng-show="timeSheet.status=='SUBMITTED'" class="label label-info">Submitted</span>
					<span ng-show="timeSheet.status=='APPROVED'" class="label label-success">Approved</span>
				</li>
			</ul>
		</div>
		<div class="panel-body" ng-show="isAdmin">
			<ul class="list-unstyled">
				<li ng-repeat="(workerId,timeSheetList) in adminWorkerTimeSheetMap | orderBy:'worker.lastName'" ng-init="worker=workersMap[workerId]">
					<a ng-href="#/worker?id={{workerId}}">{{worker.lastName}}, {{worker.firstName}} <span class="text-muted">{{worker.email}}</span></a>
					<ul>
						<li ng-repeat="timeSheet in timeSheetList | orderBy:'startDate':1 ">
							<button type="button" id="delete-{{timeSheet.id}}" class="btn btn-sm btn-default" ng-click="remove(timeSheet);" ng-show="debug">Delete</button>
							<a ng-click="set(timeSheet)">{{timeSheet.printableTimeSheetString}}</a>
							<span ng-show="timeSheet.flagged" class="label label-danger"><span class="glyphicon glyphicon-flag"></span>&nbsp;</span>
							<span ng-show="timeSheet.status=='UNSUBMITTED'" class="label label-warning">Not Submitted</span>
							<span ng-show="timeSheet.status=='SUBMITTED'" class="label label-info">Submitted</span>
							<span ng-show="timeSheet.status=='APPROVED'" class="label label-success">Approved</span>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	
	<div class="alert alert-warning alert-dismissable" ng-show="edit && (currentTimeSheet.currentTimeSheet === false)">
	  	<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
	  	<strong>Warning!</strong> You are editing an old time sheet.  <a href="#/timesheet?id=current">Click here</a> for the current timesheet.
	</div>

	<form role="form" name="createTimeSheetForm">
		<div id="createTimeSheet" class="panel panel-default" ng-show="edit">
			<div class="panel-heading">
				<h4>
					<span ng-show="currentTimeSheet.id">Edit TimeSheet: {{currentTimeSheet.startDate}} <span ng-show="isAdmin">for <a
							ng-href="#/worker?id={{currentTimeSheet.workerId}}">{{workersMap[currentTimeSheet.workerId].firstName}}
								{{workersMap[currentTimeSheet.workerId].lastName}}</a></span>
					</span>
				</h4>
				<div class="row">
					<div class="col-sm-12">
						<small><span class="text-muted">As of {{currentTimeSheet.updateTimestamp}}</span></small>
						
						<label class="label label-success" title="A submitted time card can still be updated by clicking the 'Update' button below."
						ng-show="currentTimeSheet.status!='UNSUBMITTED'">Submitted <span class="glyphicon glyphicon-ok"></span></label>
						
						<div class="btn-group btn-group-sm pull-right">
							<a type="button" class="btn btn-default" ng-disabled="!currentTimeSheet.previousTimeSheetId" ng-href="#/timesheet?id={{currentTimeSheet.previousTimeSheetId}}">Previous</a>
							<a type="button" class="btn btn-default" ng-hide="!currentTimeSheet.nextTimeSheetId" ng-href="#/timesheet?id={{currentTimeSheet.nextTimeSheetId}}">Next</a>
							
							<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
								ng-show="!currentTimeSheet.nextTimeSheetId">
								Next <span class="caret"></span> <span class="sr-only">Toggle Create Dropdown</span>
							</button>
							<ul class="dropdown-menu" role="menu">
								<li><a ng-click="setWeekNext();">Create Time Sheet for Next Week</a></li>
								<li><a ng-click="setWeekOther();">Create Time Sheet for Other Date...</a></li>
							</ul>
							
							<a type="button" class="btn"  
								ng-class="{'btn-danger':currentTimeSheet.flagged, 'btn-default':!(currentTimeSheet.flagged)}" 
								ng-click="currentTimeSheet.flagged=!(currentTimeSheet.flagged);flag(currentTimeSheet.id,currentTimeSheet.flagged);"
								ng-show="isAdmin">
								<span ng-class="{'text-muted':!(currentTimeSheet.flagged)}">
									<span class="glyphicon glyphicon-flag"></span>&nbsp;
								</span>
							</a>
							
						</div>
					</div>
				</div>
			</div>
			<div class="panel-body">
				<div class="form-group">
					<ul class="list-group">
						<li ng-repeat="day in currentTimeSheet.days" class="list-group-item row" ng-init="ii=$index">
							<div class="col-sm-3">
								<!-- {{day.entries[0].date}}&nbsp; -->
								{{dayOfWeekArr[((currentTimeSheet.startDayOfWeek + ii) % 7)].description}}
							</div>
							<div class="col-sm-9">
								<div class="row" ng-repeat="entry in day.entries" ng-controller="TimeSheetDayCtrl" ng-init="eIndex=$index">
									<div class="col-sm-3">
										<input type="time" class="form-control input-sm" ng-model="entry.startTime" title="Clock-in Time">
									</div>
									<div class="col-sm-3">
										<input type="time" class="form-control input-sm" ng-model="entry.endTime" title="Clock-out Time">
									</div>

									<div class="col-sm-6" ng-show="showButtons">
										<div class="btn-group btn-group-sm">
											<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="timeSheetLogEntry-clientId-{{ii}}"
												name="timeSheetLogEntry-clientId-{{ii}}">
												{{clientsMap[entry.clientId].name}} <span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<li>-- Select Client--</li>
												<li ng-repeat="aClientId in currentTimeSheet.availableClientIds"><a ng-click="setEntryClientId(aClientId);">{{clientsMap[aClientId].name}}</a>
												</li>
											</ul>
											<button class="btn btn-default" type="button" ng-hide="$first" ng-click="removeTimeCardLogEntry(entry);">
												<span class="glyphicon glyphicon-minus-sign"></span>&nbsp;
											</button>
											<button class="btn btn-default" type="button" ng-hide="!$last" ng-click="addNewTimeCardLogEntry(day);">
												<span class="glyphicon glyphicon-plus-sign"></span>&nbsp;
											</button>
										</div>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<div class="form-group row">
					<label for="note" class="col-sm-2 control-label">Notes</label>
					<div class="col-sm-6">
						<textarea class="form-control" id="note" name="note" rows="2" ng-model="currentTimeSheet.note"></textarea>
					</div>
				</div>
				<div class="form-group row well" ng-show="isAdmin">
					<label for="adminNote" class="col-sm-2 control-label">Admin-only Notes</label>
					<div class="col-sm-6">
						<textarea class="form-control" id="adminNote" name="adminNote" rows="2" ng-model="currentTimeSheet.adminNote"></textarea>
					</div>
				</div>
				<div class="form-group row debug" ng-show="debug">
					<p class="text-warning">Debug Properties</p>
					<label for="flagged" class="control-label">
					<input id="flagged" name="flagged" type="checkbox" ng-model="currentTimeSheet.flagged">
					Flagged
					</label>
					<br/>
					<label for="status"  class="control-label">
					<select class="input select" id="status" name="status" ng-model="currentTimeSheet.status">
						<option>UNSUBMITTED</option>
						<option>SUBMITTED</option>
						<option>APPROVED</option>
					</select>
					Status
					</label>
				</div>
				<div class="form-group row">
					<div class="col-sm-offset-2 col-sm-10">
						<button type="button" id="save" class="btn " ng-class="{'btn-primary': createTimeSheetForm.$valid}"
							ng-disabled="!(createTimeSheetForm.$valid && createTimeSheetForm.$dirty)" ng-click="save(currentTimeSheet);">
							<span ng-show="currentTimeSheet.status!='UNSUBMITTED'">Update</span>
							<span ng-show="currentTimeSheet.status=='UNSUBMITTED'">Save</span>
							</button>
						<span ng-show="currentTimeSheet.status=='UNSUBMITTED'">
						<button type="button" id="submit" class="btn btn-default" ng-click="submit(currentTimeSheet);" ng-disabled="!isSubmittable(currentTimeSheet);">Submit</button>
						<p class="text-muted">A time sheet may still be updated after it has been submitted.</p>
						</span>

					</div>
				</div>
			</div>
		</div>

		<pre ng-show="debug" class="debug">
createTimeSheetForm.$dirty   ={{createTimeSheetForm.$dirty}}

createTimeSheetForm.$pristine={{createTimeSheetForm.$pristine}}

createTimeSheetForm.$valid   ={{createTimeSheetForm.$valid}}
</pre>

	</form>

	<div class="well" ng-cloak ng-show="debug">
		<pre class="debug">
isAdmin={{isAdmin}}
<input type="checkbox" ng-model="showCurrentTimeSheet" ng-init="showCurrentTimeSheet=true">currentTimeSheet=<span
				ng-show="showCurrentTimeSheet">{{currentTimeSheet | json}}</span>
<input type="checkbox" ng-model="showTimeSheetsMap" ng-init="showTimeSheetsMap=false">timeSheetsMap=<span
				ng-show="showTimeSheetsMap">{{timeSheetsMap | json}}</span>
<input type="checkbox" ng-model="showClientsMap" ng-init="showClientsMap=false">clientsMap=<span ng-show="showClientsMap">{{clientsMap | json}}</span>
<input type="checkbox" ng-model="showWorkersMap" ng-init="showWorkersMap=true">workersMap=<span ng-show="showWorkersMap">{{workersMap | json}}</span>
</pre>
	</div>
</div>

</div>